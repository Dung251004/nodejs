<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<li>
    <a href="#"></a>
</li>
<body>
    <script> //Rest API

const express = require('express');
const bodyParser = require('body-parser');
const mongoose = require('mongoose');

const app = express();
app.use(bodyParser.urlencoded({ extended: true }));
app.use(bodyParser.json());

mongoose.connect('mongodb://localhost:27017/productDB', { useNewUrlParser: true, useUnifiedTopology: true });
const Product = mongoose.model('Product', {
    maSanPham: String,
    tenSanPham: String,
    ngaySanPham: Date,
    xuatXuSanPham: String,
    gia: Number,
    soLuong: Number
});

// POST method to insert new product
app.post('/products', (req, res) => {
    const { maSanPham, tenSanPham, ngaySanPham, xuatXuSanPham, gia, soLuong } = req.body;
    const newProduct = new Product({
        maSanPham,
        tenSanPham,
        ngaySanPham,
        xuatXuSanPham,
        gia,
        soLuong
    });
    newProduct.save()
        .then(product => {
            res.send(product);
        })
        .catch(err => {
            res.status(500).send({
                message: err.message || "Some error occurred while creating the product."
            });
        });
});

// DELETE method to delete a product by ID
app.delete('/products/:id', (req, res) => {
    const id = req.params.id;
    Product.findByIdAndRemove(id)
        .then(product => {
            if (!product) {
                return res.status(404).send({
                    message: "Product not found with id " + id
                });
            }
            res.send({ message: "Product deleted successfully!" });
        })
        .catch(err => {
            if (err.kind === 'ObjectId' || err.name === 'NotFound') {
                return res.status(404).send({
                    message: "Product not found with id " + id
                });
            }
            return res.status(500).send({
                message: "Could not delete product with id " + id
            });
        });
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
    console.log(`Server is running on port ${PORT}`);
});


    </script>


    <script>    //Website
        const express = require('express');
const bodyParser = require('body-parser');
const mongoose = require('mongoose');

const app = express();
app.set('view engine', 'ejs');
app.use(bodyParser.urlencoded({ extended: true }));
app.use(express.static("public"));

mongoose.connect('mongodb://localhost:27017/productDB', { useNewUrlParser: true, useUnifiedTopology: true });
const Product = mongoose.model('Product', {
    maSanPham: String,
    tenSanPham: String,
    ngaySanPham: Date,
    xuatXuSanPhamgia: Number,
    soLuong: Number,
    maSanPhamCuaHang:String

});

// GET method to retrieve all products
app.get('/', (req, res) => {
    Product.find({}, (err, foundProducts) => {
        if (err) {
            console.log(err);
        } else {
            res.render('index', { products: foundProducts });
        }
    });
});

// POST method to insert new product
app.post('/products', (req, res) => {
    const { maSanPham, tenSanPham, ngaySanPham, xuatXuSanPhamgia, soLuong,maSanPhamCuaHang } = req.body;
    const newProduct = new Product({
        maSanPham,
        tenSanPham,
        ngaySanPham,
        xuatXuSanPhamgia,
        soLuong,
        maSanPhamCuaHang
    });
    newProduct.save();
    res.redirect('/');
});

// DELETE method to delete a product by ID
app.post('/delete', (req, res) => {
    const id = req.body.id;
    Product.findByIdAndRemove(id, (err) => {
        if (err) {
            console.log(err);
        } else {
            res.redirect('/');
        }
    });
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
    console.log(`Server is running on port ${PORT}`);
});

    </script>
    <script>    //sanpham
        Product.find({}).sort({ maSanPham: A12,tenSanPham: Product1, ngaySanPham: 22/08/2023, xuatXuSanPhamgia: 5000000, soLuong: 1000, maSanPhamCuaHang: S10 }).exec((err, foundProducts) => {
    if (err) {
        console.log(err);
    } else {
        // Process foundProducts
    }
});

    </script>
</body>
</html>